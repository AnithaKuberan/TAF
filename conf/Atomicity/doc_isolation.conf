# Test cases for 'Invisible staged docs for Transactions' (MB-37374 / TXNJ-125)

Atomicity.doc_isolation.IsolationDocTest:
    # Create Tests
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeAtrPending,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterAtrPending,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=create,operation=beforeAtrRolledBack,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterAtrCommit,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterStagedInsertComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterStagedReplaceComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterStagedRemoveComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeStagedInsert,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeDocRemoved,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=create,operation=beforeDocRolledBack,GROUP=P0;staged_doc

    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeAtrPending,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterAtrPending,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=create,operation=beforeAtrRolledBack,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterAtrCommit,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterStagedInsertComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterStagedReplaceComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterStagedRemoveComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=afterDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeStagedInsert,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=create,operation=beforeDocRemoved,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=create,operation=beforeDocRolledBack,GROUP=P0;staged_doc

    # Update Tests
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeAtrPending,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterAtrPending,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=update,operation=beforeAtrRolledBack,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterAtrCommit,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterStagedInsertComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterStagedReplaceComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterStagedRemoveComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeStagedInsert,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeDocRemoved,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=update,operation=beforeDocRolledBack,GROUP=P0;staged_doc

    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeAtrPending,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterAtrPending,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=update,operation=beforeAtrRolledBack,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterAtrCommit,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterStagedInsertComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterStagedReplaceComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterStagedRemoveComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=afterDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeStagedInsert,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=update,operation=beforeDocRemoved,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=update,operation=beforeDocRolledBack,GROUP=P0;staged_doc

    # Delete Tests
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeAtrPending,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterAtrPending,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=delete,operation=beforeAtrRolledBack,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterAtrCommit,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterStagedInsertComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterStagedReplaceComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterStagedRemoveComplete,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeStagedInsert,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeDocRemoved,GROUP=P0;staged_doc
    test_staged_doc_read,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=delete,operation=beforeDocRolledBack,GROUP=P0;staged_doc

    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeAtrPending,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterAtrPending,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=delete,operation=beforeAtrRolledBack,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterAtrCommit,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterAtrComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterStagedInsertComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterStagedReplaceComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterStagedRemoveComplete,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=afterDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeDocCommitted,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeStagedInsert,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=True,doc_op=delete,operation=beforeDocRemoved,GROUP=P0;staged_doc
    test_staged_doc_query,nodes_init=2,num_items=1,replicas=1,transaction_timeout=30,transaction_commit=False,doc_op=delete,operation=beforeDocRolledBack,GROUP=P0;staged_doc

    # Transaction with purger + bucket_compaction (Expiry Purger interval is set 1 greater than trans timeout)
    test_run_purger_during_transaction,nodes_init=2,replicas=1,num_items=100000,transaction_timeout=200,GROUP=P0

    # Tranx docs same as keys just got deleted but exists as tomb stones
    test_transaction_docs_keys_already_in_tombstone,nodes_init=2,replicas=1,num_items=10000,transaction_timeout=100,GROUP=P0
    test_transaction_docs_keys_already_in_tombstone,nodes_init=2,replicas=1,num_items=10000,maxttl=30,transaction_timeout=100,GROUP=P0

    # Rollback test using muliple docs
    test_rollback_transaction,nodes_init=2,replicas=1,num_items=5000,transaction_timeout=60,doc_op=create,GROUP=P0
    test_rollback_transaction,nodes_init=2,replicas=1,num_items=5000,transaction_timeout=60,doc_op=update,GROUP=P0
    test_rollback_transaction,nodes_init=2,replicas=1,num_items=5000,transaction_timeout=60,doc_op=delete,GROUP=P0

    # Rebalance with creates
    test_transaction_with_rebalance,nodes_init=1,replicas=0,rebalance_type=in,nodes_in=3,doc_op=create,GROUP=P0
    test_transaction_with_rebalance,nodes_init=4,replicas=2,rebalance_type=out,nodes_out=1,doc_op=create,GROUP=P0
    test_transaction_with_rebalance,nodes_init=2,replicas=1,rebalance_type=swap,nodes_in=2,nodes_out=2,doc_op=create,GROUP=P0

    # Rebalance with updates
    test_transaction_with_rebalance,nodes_init=1,replicas=0,rebalance_type=in,nodes_in=3,doc_op=update,GROUP=P0
    test_transaction_with_rebalance,nodes_init=4,replicas=2,rebalance_type=out,nodes_out=1,doc_op=update,GROUP=P0
    test_transaction_with_rebalance,nodes_init=2,replicas=1,rebalance_type=swap,nodes_in=2,nodes_out=2,doc_op=update,GROUP=P0

    # Rebalance with deletes
    test_transaction_with_rebalance,nodes_init=1,replicas=0,rebalance_type=in,nodes_in=3,doc_op=delete,GROUP=P0
    test_transaction_with_rebalance,nodes_init=4,replicas=2,rebalance_type=out,nodes_out=1,doc_op=delete,GROUP=P0
    test_transaction_with_rebalance,nodes_init=2,replicas=1,rebalance_type=swap,nodes_in=2,nodes_out=2,doc_op=delete,GROUP=P0
