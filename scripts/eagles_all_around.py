from com.jcraft.jsch import JSchException
from com.jcraft.jsch import JSch
from org.python.core.util import FileUtil
import os

failed = []
def run(command, session):
    output = []
    error = []
    try:
        _ssh_client = session.openChannel("exec")
        _ssh_client.setInputStream(None)
        _ssh_client.setErrStream(None)

        instream = _ssh_client.getInputStream()
        errstream = _ssh_client.getErrStream()
        _ssh_client.setCommand(command)
        _ssh_client.connect()
        fu1 = FileUtil.wrap(instream)
        for line in fu1.readlines():
            output.append(line)
        fu1.close()

        fu2 = FileUtil.wrap(errstream)
        for line in fu2.readlines():
            error.append(line)
        fu2.close()
        _ssh_client.disconnect()
    except JSchException as e:
        print("JSch exception on %s: %s" % (server, str(e)))
    return output, error

def connection(server):
    try:
        jsch = JSch()
        session = jsch.getSession("root", server, 22)
        session.setPassword("couchbase")
        session.setConfig("StrictHostKeyChecking", "no")
        session.connect(5000)
        return session
    except:
        failed.append(server)
        return None

def scan_all_slaves():
    magma_slaves = ["172.23.123.170","172.23.120.26","172.23.120.223","172.23.120.103","172.23.120.84",
                    "172.23.120.104","172.23.123.184","172.23.120.105","172.23.120.106","172.23.120.85"]

    all_slaves = ["172.23.106.136","172.23.121.65","172.23.105.66","172.23.108.94","172.23.104.254",
                  "172.23.120.172","172.23.100.195","172.23.109.166","172.23.122.36","172.23.122.37",
                  "172.23.122.38","172.23.99.156","172.23.120.106","172.23.123.184","172.23.120.84",
                  "172.23.120.223","172.23.120.26","172.23.120.85","172.23.120.90","172.23.120.103",
                  "172.23.120.104","172.23.120.105","172.23.105.131","172.23.106.231","172.23.105.170",
                  "172.23.98.7","172.23.105.169","172.23.106.94","172.23.96.83","172.23.109.38",
                  "172.23.106.41","172.23.106.43","172.23.106.34","172.23.105.209","172.23.107.165",
                  "172.23.104.30","172.23.108.6","172.23.106.230","172.23.96.110","172.23.107.166",
                  "172.23.109.52","172.23.104.35","172.23.105.174","172.23.211.37","172.23.106.193",
                  "172.23.107.226","172.23.106.162","172.23.105.95","172.23.105.40","172.23.108.33",
                  "172.23.105.135","172.23.105.136","172.23.96.232","172.23.96.246","172.23.96.248",
                  "172.23.96.255","172.23.97.0","172.23.96.206","172.23.105.248","172.23.107.249",
                  "172.23.107.21","172.23.107.68","172.23.121.16","172.23.120.254","172.23.120.31",
                  "172.23.120.228","172.23.108.27","172.23.104.76","172.23.105.144","172.23.108.222",
                  "172.23.107.238","172.23.106.205","172.23.105.131","172.23.105.131","172.23.105.115",
                  "172.23.123.88","172.23.123.91","172.23.123.69","172.23.123.69","172.23.123.71",
                  "172.23.123.72","172.23.123.75","172.23.123.73","172.23.123.74","172.23.123.70",
                  "172.23.123.77","172.23.123.80","172.23.123.76","172.23.123.78","172.23.123.80",
                  "172.23.123.79","172.23.97.128","172.23.99.156","172.23.104.136","172.23.97.128",
                  "172.23.99.156","172.23.97.101","172.23.107.216","172.23.104.34"
                  ]
    count = 1
    for server in all_slaves:
        print "--+--+--+--+-- {}. CHECKING ON SLAVE: {} --+--+--+--+--".format(count, server)
        count += 1
        session = connection(server)
        if session is None:
            continue
        output, error = run("find /data/workspace/ -iname '*collect*2020-08-19*.zip'", session)
        try:
            for cbcollect_zips in output:
                log_files, error = run("zipinfo -1 {}".format(cbcollect_zips), session)
                for file in log_files:
                    if file.rstrip().endswith("dmp"):
                        print cbcollect_zips.rstrip()
                        print file.rstrip()
                        run("rm -rf /root/cbcollect*", session)[0]
                        run("unzip {}".format(cbcollect_zips), session)[0]
                        print "".join(run("grep CRITICAL {} | grep -v 'Rollback point not found'".format("/root/cbcollect*/memcached.log.*"), session)[0])
                        print "#######################"
                        break
        except:
            pass
        session.disconnect()


def check_coredump_exist(server):
    binCb = "/opt/couchbase/bin/"
    libCb = "/opt/couchbase/var/lib/couchbase/"
    crashDir = "/opt/couchbase/var/lib/couchbase/"
    crashDirWin = "c://CrashDumps"
    result = False
    dmpmsg = ""
    streammsg = ""
    session = connection(server)
    
    if session is None:
        return

    def findIndexOf(strList, subString):
        for i in range(len(strList)):
            if subString in strList[i]:
                return i
        return -1

    def get_gdb(dmpPath, dmpName):
        dmpFile = dmpPath + dmpName
        coreFile = dmpPath + dmpName.strip(".dmp") + ".core"
        run("rm -rf " + coreFile, session)
        run("/" + binCb + "minidump-2-core " + dmpFile + " > " + coreFile, session)
        gdbOut = run("gdb --batch " + binCb + "memcached -c " + coreFile + " -ex bt full -ex quit", session)[0]
        index = findIndexOf(gdbOut, "Core was generated by")
        gdbOut = gdbOut[index:]
        gdbOut = " ".join(gdbOut)
        return gdbOut

    print(server + " : SSH Successful")
    print(server + " : Looking for crash dump files")
    crashDir = libCb + "crash/"
    dmpFiles = run("ls -lt " + crashDir, session)[0]
    dmpFiles = [f for f in dmpFiles if ".core" not in f]
    dmpFiles = [f for f in dmpFiles if "total" not in f]
    dmpFiles = [f.split()[-1] for f in dmpFiles if ".core" not in f]
    dmpFiles = [f.strip("\n") for f in dmpFiles]
    if dmpFiles:
        print run("cat /opt/couchbase/VERSION.txt", session)[0]
        msg = "Node %s - Core dump seen: %s" % (server, str(len(dmpFiles)))
        dmpmsg += msg + "\n"
        print(msg)
        print(server + " : Stack Trace of first crash: " + dmpFiles[-1])
        print(get_gdb(crashDir, dmpFiles[-1]))
    else:
        print(server + " : No crash files found")
        
    print(server + " : Looking for CRITICAL messages in log")
    logsDir = libCb + "logs/"
    logFiles = run("ls " + logsDir + "memcached.log.*", session)[0]
    for logFile in logFiles:
        criticalMessages = run("grep -r 'CRITICAL' " + logFile.strip("\n")+ "| grep -v 'Rollback point not found'", session)[0]
        index = findIndexOf(criticalMessages, "Fatal error encountered during exception handling")
        criticalMessages = criticalMessages[:index]
        if (criticalMessages):
            print(server + " : Found message in " + logFile.strip("\n"))
            print("".join(criticalMessages))
            break

    session.disconnect()

def scan_all_servers():
    servers = [
                "172.23.104.100","172.23.104.102","172.23.104.103","172.23.104.105","172.23.104.106","172.23.104.107",
                "172.23.104.109","172.23.104.110","172.23.104.117","172.23.104.129","172.23.104.132","172.23.104.136",
                "172.23.104.147","172.23.104.148","172.23.104.150","172.23.104.151","172.23.104.158","172.23.104.160",
                "172.23.104.163","172.23.104.167","172.23.104.172","172.23.104.173","172.23.104.174","172.23.104.175",
                "172.23.104.176","172.23.104.177","172.23.104.178","172.23.104.186","172.23.104.199","172.23.104.201",
                "172.23.104.202","172.23.104.203","172.23.104.207","172.23.104.208","172.23.104.211","172.23.104.216",
                "172.23.104.217","172.23.104.219","172.23.104.22","172.23.104.220","172.23.104.221","172.23.104.222",
                "172.23.104.223","172.23.104.224","172.23.104.225","172.23.104.226","172.23.104.228","172.23.104.229",
                "172.23.104.231","172.23.104.233","172.23.104.234","172.23.104.235","172.23.104.236","172.23.104.237",
                "172.23.104.238","172.23.104.239","172.23.104.241","172.23.104.242","172.23.104.243","172.23.104.244",
                "172.23.104.245","172.23.104.246","172.23.104.247","172.23.104.248","172.23.104.249","172.23.104.250",
                "172.23.104.251","172.23.104.252","172.23.104.253","172.23.104.255","172.23.104.46","172.23.104.73",
                "172.23.104.76","172.23.104.80","172.23.104.86","172.23.104.90","172.23.104.91","172.23.104.92",
                "172.23.104.97","172.23.104.98","172.23.104.99","172.23.105.0","172.23.105.1","172.23.105.10",
                "172.23.105.101","172.23.105.102","172.23.105.109","172.23.105.122","172.23.105.123","172.23.105.126",
                "172.23.105.127","172.23.105.128","172.23.105.130","172.23.105.137","172.23.105.138","172.23.105.145",
                "172.23.105.152","172.23.105.155","172.23.105.158","172.23.105.159","172.23.105.161","172.23.105.162",
                "172.23.105.163","172.23.105.164","172.23.105.165","172.23.105.166","172.23.105.171","172.23.105.173",
                "172.23.105.183","172.23.105.185","172.23.105.188","172.23.105.19","172.23.105.190","172.23.105.195",
                "172.23.105.197","172.23.105.199","172.23.105.2","172.23.105.20","172.23.105.200","172.23.105.201",
                "172.23.105.204","172.23.105.205","172.23.105.206","172.23.105.208","172.23.105.210","172.23.105.211",
                "172.23.105.212","172.23.105.213","172.23.105.214","172.23.105.215","172.23.105.217","172.23.105.218",
                "172.23.105.219","172.23.105.22","172.23.105.220","172.23.105.221","172.23.105.223","172.23.105.224",
                "172.23.105.225","172.23.105.226","172.23.105.227","172.23.105.229","172.23.105.230","172.23.105.232",
                "172.23.105.233","172.23.105.234","172.23.105.235","172.23.105.236","172.23.105.237","172.23.105.238",
                "172.23.105.24","172.23.105.240","172.23.105.242","172.23.105.243","172.23.105.244","172.23.105.245",
                "172.23.105.246","172.23.105.247","172.23.105.249","172.23.105.250","172.23.105.251","172.23.105.252",
                "172.23.105.253","172.23.105.254","172.23.105.255","172.23.105.26","172.23.105.27","172.23.105.3",
                "172.23.105.30","172.23.105.31","172.23.105.32","172.23.105.33","172.23.105.34","172.23.105.35",
                "172.23.105.4","172.23.105.41","172.23.105.42","172.23.105.44","172.23.105.45","172.23.105.46",
                "172.23.105.47","172.23.105.49","172.23.105.5","172.23.105.50","172.23.105.51","172.23.105.52",
                "172.23.105.53","172.23.105.55","172.23.105.56","172.23.105.59","172.23.105.64","172.23.105.65",
                "172.23.105.67","172.23.105.7","172.23.105.71","172.23.105.75","172.23.105.76","172.23.105.79",
                "172.23.105.8","172.23.105.80","172.23.105.81","172.23.105.82","172.23.105.84","172.23.105.85",
                "172.23.105.86","172.23.105.87","172.23.105.88","172.23.105.9","172.23.105.96","172.23.106.0",
                "172.23.106.1","172.23.106.10","172.23.106.107","172.23.106.108","172.23.106.11","172.23.106.110",
                "172.23.106.111","172.23.106.116","172.23.106.118","172.23.106.13","172.23.106.140","172.23.106.141",
                "172.23.106.142","172.23.106.147","172.23.106.15","172.23.106.154","172.23.106.155","172.23.106.156",
                "172.23.106.159","172.23.106.16","172.23.106.164","172.23.106.167","172.23.106.17","172.23.106.18",
                "172.23.106.19","172.23.106.2","172.23.106.20","172.23.106.202","172.23.106.204","172.23.106.208",
                "172.23.106.209","172.23.106.228","172.23.106.234","172.23.106.237","172.23.106.239","172.23.106.244",
                "172.23.106.245","172.23.106.246","172.23.106.247","172.23.106.248","172.23.106.249","172.23.106.25",
                "172.23.106.250","172.23.106.254","172.23.106.29","172.23.106.3","172.23.106.30","172.23.106.31",
                "172.23.106.32","172.23.106.35","172.23.106.36","172.23.106.37","172.23.106.38","172.23.106.39",
                "172.23.106.4","172.23.106.40","172.23.106.42","172.23.106.44","172.23.106.45","172.23.106.47",
                "172.23.106.48","172.23.106.49","172.23.106.50","172.23.106.51","172.23.106.52","172.23.106.53",
                "172.23.106.54","172.23.106.55","172.23.106.56","172.23.106.6","172.23.106.60","172.23.106.62",
                "172.23.106.63","172.23.106.66","172.23.106.69","172.23.106.70","172.23.106.71","172.23.106.8",
                "172.23.106.85","172.23.106.87","172.23.106.89","172.23.106.9","172.23.106.90","172.23.106.92",
                "172.23.107.100","172.23.107.104","172.23.107.105","172.23.107.107","172.23.107.109","172.23.107.113",
                "172.23.107.114","172.23.107.125","172.23.107.130","172.23.107.135","172.23.107.138","172.23.107.139",
                "172.23.107.141","172.23.107.145","172.23.107.169","172.23.107.18","172.23.107.182","172.23.107.187",
                "172.23.107.194","172.23.107.196","172.23.107.197","172.23.107.198","172.23.107.201","172.23.107.205",
                "172.23.107.206","172.23.107.207","172.23.107.218","172.23.107.232","172.23.107.234","172.23.107.29",
                "172.23.107.30","172.23.107.38","172.23.107.40","172.23.107.48","172.23.107.50","172.23.107.51",
                "172.23.107.52","172.23.107.53","172.23.107.58","172.23.107.59","172.23.107.63","172.23.107.65",
                "172.23.107.66","172.23.107.67","172.23.107.7","172.23.107.71","172.23.107.74","172.23.107.78",
                "172.23.107.87","172.23.107.93","172.23.108.109","172.23.108.16","172.23.108.17","172.23.108.170",
                "172.23.108.208","172.23.108.210","172.23.108.211","172.23.108.212","172.23.108.213","172.23.108.227",
                "172.23.108.228","172.23.108.229","172.23.108.236","172.23.108.237","172.23.108.238","172.23.108.239",
                "172.23.108.240","172.23.108.241","172.23.108.46","172.23.108.91","172.23.109.109","172.23.109.140",
                "172.23.109.20","172.23.109.21","172.23.109.22","172.23.109.23","172.23.109.251","172.23.109.39",
                "172.23.109.40","172.23.109.49","172.23.109.71","172.23.109.72","172.23.109.8","172.23.109.9",
                "172.23.120.101","172.23.120.111","172.23.120.116","172.23.120.117","172.23.120.118","172.23.120.119",
                "172.23.120.120","172.23.120.121","172.23.120.122","172.23.120.123","172.23.120.124","172.23.120.125",
                "172.23.120.126","172.23.120.127","172.23.120.128","172.23.120.129","172.23.120.148","172.23.120.150",
                "172.23.120.162","172.23.120.164","172.23.120.167","172.23.120.175","172.23.120.177","172.23.120.178",
                "172.23.120.182","172.23.120.185","172.23.120.188","172.23.120.19","172.23.120.192","172.23.120.196",
                "172.23.120.197","172.23.120.201","172.23.120.202","172.23.120.205","172.23.120.206","172.23.120.215",
                "172.23.120.222","172.23.120.229","172.23.120.230","172.23.120.232","172.23.120.233","172.23.120.235",
                "172.23.120.240","172.23.120.249","172.23.120.253","172.23.120.255","172.23.120.29","172.23.120.32",
                "172.23.120.66","172.23.120.78","172.23.120.79","172.23.120.86","172.23.120.92","172.23.120.93",
                "172.23.120.94","172.23.120.95","172.23.121.10","172.23.121.101","172.23.121.125","172.23.121.137",
                "172.23.121.141","172.23.121.145","172.23.121.146","172.23.121.148","172.23.121.149","172.23.121.150",
                "172.23.121.151","172.23.121.159","172.23.121.160","172.23.121.161","172.23.121.17","172.23.121.171",
                "172.23.121.174","172.23.121.178","172.23.121.18","172.23.121.19","172.23.121.201","172.23.121.204",
                "172.23.121.206","172.23.121.207","172.23.121.208","172.23.121.209","172.23.121.210","172.23.121.212",
                "172.23.121.213","172.23.121.214","172.23.121.215","172.23.121.216","172.23.121.217","172.23.121.219",
                "172.23.121.22","172.23.121.220","172.23.121.221","172.23.121.222","172.23.121.223","172.23.121.229",
                "172.23.121.230","172.23.121.231","172.23.121.232","172.23.121.234","172.23.121.236","172.23.121.237",
                "172.23.121.238","172.23.107.93","172.23.121.24","172.23.121.240","172.23.121.241","172.23.121.242",
                "172.23.121.243","172.23.121.244","172.23.121.245","172.23.121.246","172.23.121.247","172.23.121.248",
                "172.23.121.25","172.23.121.250","172.23.121.251","172.23.121.252","172.23.121.253","172.23.121.254",
                "172.23.121.255","172.23.121.26","172.23.121.27","172.23.121.30","172.23.121.38","172.23.121.42",
                "172.23.121.44","172.23.121.45","172.23.121.50","172.23.121.70","172.23.121.72","172.23.121.75",
                "172.23.121.76","172.23.121.79","172.23.121.87","172.23.121.88","172.23.121.89","172.23.121.91",
                "172.23.121.93","172.23.121.94","172.23.121.95","172.23.122.0","172.23.122.100","172.23.122.101",
                "172.23.122.102","172.23.122.103","172.23.122.104","172.23.122.105","172.23.122.106","172.23.122.107",
                "172.23.122.108","172.23.122.109","172.23.122.110","172.23.122.111","172.23.122.112","172.23.122.113",
                "172.23.122.114","172.23.122.115","172.23.122.116","172.23.122.117","172.23.122.118","172.23.122.119",
                "172.23.122.120","172.23.122.121","172.23.122.122","172.23.122.123","172.23.122.124","172.23.122.125",
                "172.23.122.126","172.23.122.127","172.23.122.128","172.23.122.129","172.23.122.130","172.23.122.131",
                "172.23.122.132","172.23.122.133","172.23.122.134","172.23.122.135","172.23.122.136","172.23.122.137",
                "172.23.122.138","172.23.122.139","172.23.122.140","172.23.122.141","172.23.122.142","172.23.122.143",
                "172.23.122.144","172.23.122.145","172.23.122.146","172.23.122.147","172.23.122.148","172.23.122.149",
                "172.23.122.150","172.23.122.151","172.23.122.152","172.23.122.153","172.23.122.154","172.23.122.155",
                "172.23.122.156","172.23.122.157","172.23.122.158","172.23.122.159","172.23.122.160","172.23.122.161",
                "172.23.122.162","172.23.122.163","172.23.122.164","172.23.122.165","172.23.122.166","172.23.122.167",
                "172.23.122.168","172.23.122.169","172.23.122.170","172.23.122.171","172.23.122.172","172.23.122.173",
                "172.23.122.174","172.23.122.175","172.23.122.176","172.23.122.177","172.23.122.178","172.23.122.179",
                "172.23.122.180","172.23.122.181","172.23.122.182","172.23.122.183","172.23.122.201","172.23.122.208",
                "172.23.122.221","172.23.122.223","172.23.122.224","172.23.122.225","172.23.122.226","172.23.122.227",
                "172.23.122.228","172.23.122.229","172.23.122.231","172.23.122.240","172.23.122.241","172.23.122.242",
                "172.23.122.243","172.23.122.245","172.23.122.246","172.23.122.247","172.23.122.248","172.23.122.249",
                "172.23.122.51","172.23.122.52","172.23.122.53","172.23.122.54","172.23.122.58","172.23.122.59",
                "172.23.122.60","172.23.122.61","172.23.122.62","172.23.122.63","172.23.122.64","172.23.122.65",
                "172.23.122.66","172.23.122.67","172.23.122.68","172.23.122.69","172.23.122.70","172.23.122.71",
                "172.23.122.72","172.23.122.73","172.23.122.74","172.23.122.75","172.23.122.77","172.23.122.78",
                "172.23.122.79","172.23.122.80","172.23.122.81","172.23.122.82","172.23.122.83","172.23.122.86",
                "172.23.122.87","172.23.122.88","172.23.122.90","172.23.122.91","172.23.122.92","172.23.122.93",
                "172.23.122.94","172.23.122.95","172.23.122.96","172.23.122.97","172.23.122.98","172.23.122.99",
                "172.23.123.10","172.23.123.100","172.23.123.101","172.23.123.102","172.23.123.103","172.23.123.104",
                "172.23.123.105","172.23.123.107","172.23.123.108","172.23.123.109","172.23.123.11","172.23.123.111",
                "172.23.123.114","172.23.123.115","172.23.123.116","172.23.123.117","172.23.123.118","172.23.123.119",
                "172.23.123.12","172.23.123.120","172.23.123.121","172.23.123.122","172.23.123.123","172.23.123.124",
                "172.23.123.125","172.23.123.127","172.23.123.128","172.23.123.129","172.23.123.130","172.23.123.131",
                "172.23.123.132","172.23.123.133","172.23.123.134","172.23.123.135","172.23.123.136","172.23.123.137",
                "172.23.123.138","172.23.123.140","172.23.123.141","172.23.123.142","172.23.123.143","172.23.123.144",
                "172.23.123.145","172.23.123.146","172.23.123.147","172.23.123.148","172.23.123.149","172.23.123.150",
                "172.23.123.151","172.23.123.152","172.23.123.153","172.23.123.154","172.23.123.155","172.23.123.156",
                "172.23.123.157","172.23.123.158","172.23.123.159","172.23.123.160","172.23.123.161","172.23.123.162",
                "172.23.123.163","172.23.123.164","172.23.123.4","172.23.123.42","172.23.123.44","172.23.123.46",
                "172.23.123.47","172.23.123.48","172.23.123.49","172.23.123.5","172.23.123.50","172.23.123.51",
                "172.23.123.52","172.23.123.53","172.23.123.54","172.23.123.55","172.23.123.56","172.23.123.57",
                "172.23.123.58","172.23.123.59","172.23.123.6","172.23.123.60","172.23.123.61","172.23.123.62",
                "172.23.123.63","172.23.123.64","172.23.123.65","172.23.123.66","172.23.123.67","172.23.123.68",
                "172.23.123.7","172.23.123.8","172.23.123.82","172.23.123.83","172.23.123.84","172.23.123.85",
                "172.23.123.86","172.23.123.87","172.23.123.89","172.23.123.9","172.23.123.90","172.23.123.92",
                "172.23.123.93","172.23.123.94","172.23.123.95","172.23.123.96","172.23.123.97","172.23.123.98",
                "172.23.123.99","172.23.96.112","172.23.96.115","172.23.96.136","172.23.96.141","172.23.96.157",
                "172.23.96.164","172.23.96.169","172.23.96.170","172.23.96.181","172.23.96.186","172.23.96.189",
                "172.23.96.203","172.23.96.45","172.23.96.54","172.23.96.55","172.23.96.63","172.23.96.90",
                "172.23.97.1","172.23.97.113","172.23.97.140","172.23.97.141","172.23.97.142","172.23.97.143",
                "172.23.97.166","172.23.97.218","172.23.97.219","172.23.97.220","172.23.97.221","172.23.97.222",
                "172.23.97.223","172.23.97.224","172.23.97.225","172.23.97.226","172.23.97.227","172.23.97.228",
                "172.23.97.229","172.23.97.230","172.23.97.58","172.23.97.59","172.23.97.60","172.23.97.61",
                "172.23.97.62","172.23.97.63","172.23.97.64","172.23.97.65","172.23.97.66","172.23.97.67",
                "172.23.97.82","172.23.97.83","172.23.97.84","172.23.97.85","172.23.97.86","172.23.97.87",
                "172.23.97.88","172.23.97.89","172.23.97.90","172.23.97.91","172.23.97.92","172.23.97.93",
                "172.23.98.11","172.23.98.12","172.23.98.13","172.23.98.14","172.23.98.15","172.23.98.16",
                "172.23.98.164","172.23.98.165","172.23.98.17","172.23.98.170","172.23.98.18","172.23.98.19",
                "172.23.98.195","172.23.98.196","172.23.98.20","172.23.98.209","172.23.98.21","172.23.98.213",
                "172.23.98.214","172.23.98.215","172.23.98.79","172.23.98.80","172.23.98.81","172.23.98.82",
                "172.23.98.83","172.23.99.128","172.23.99.190","172.23.99.232","172.23.99.235","172.23.99.253",
                "172.23.99.69","172.23.99.70","172.23.99.93","172.23.100.195","172.23.109.166","172.23.122.36",
                "172.23.122.37","172.23.122.38"
        ]
    count = 1
    for server in servers:
        print "--+--+--+--+-- {}. CHECKING ON SERVER: {} --+--+--+--+--".format(count, server)
        count += 1
        check_coredump_exist(server)
        
scan_all_servers()
scan_all_slaves()

if failed:
    for server in failed:
        print "ssh failed: %s" % server